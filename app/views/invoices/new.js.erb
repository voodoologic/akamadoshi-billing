<% if params[:search].present? %>
    window.location = '<%= invoices_url(search: params[:search]) %>'
<% else %>
    $('body').append("<%= escape_javascript render partial: 'invoice_form_popup', locals: {invoice: @invoice}  %>");
    // call Invoice coffee script functions
    Invoice.change_invoice_item();
    Invoice.changeTax();
    Invoice.load_functions();

    elem = $("#invoice_form_popup");
    Popup.initialize(elem);
    Popup.open(elem);

<% end %>